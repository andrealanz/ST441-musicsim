---
title: "Sonance"
author: "Andrea Lanz"
date: "11/26/2018"
output: html_document
   keep_md: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(purrr)
library(here)
```

## Consonace 

 - Which notes sound good together?
 
 - Notes with frequencies with simple ratios
 
 - The different scales are examples of notes with consonant sounds

The purpose of this file is to implement more consonant notes in my simulation of music. 

The following data was found at the following source:

 - Suits, B. H., Physics of Music - Notes. Physics Department, Michigan Technological University. http://pages.mtu.edu/~suits/notefreqs.html

Read in notes data:
```{r}
full_notes <- read.csv(here("data", "note_freq.csv")) #includes all parts of dataframe
full_notes
notes <- (read.csv("data/note_freq.csv"))$Frequency..Hz. #just the frequencies
```

The following will assign the sequence of numbers that corresponds to all octaves of a specific note in the frequency data.
```{r}
note_A <- seq(from = 1, to = 85, by = 12)
note_B <- seq(from = 3, to = 87, by = 12)
note_C <- seq(from = 4, to = 88, by = 12)
note_D <- seq(from = 6, to = 78, by = 12)
note_E <- seq(from = 8, to = 80, by = 12)
note_F <- seq(from = 9, to = 81, by = 12)
note_G <- seq(from = 11, to = 83, by = 12)

note_Asharp <- seq(from = 2, to = 86, by = 12)
note_Csharp <- seq(from = 5, to = 77, by = 12)
note_Dsharp <- seq(from = 4, to = 88, by = 12)
note_Fsharp <- seq(from = 4, to = 88, by = 12)
note_Gsharp <- seq(from = 4, to = 88, by = 12)
```

Create a transition matrix for the C major scale (C,D,E,F,G,A):

View the C Major note frequencies:
```{r}
C_major <- c(note_C,note_D, note_E, note_F, note_G, note_A)
C_major_full <- full_notes[C_major, ] 
C_major_full
```

Note that middle C is the fourth element in 'C_major', and each note has 7 octaves, except for C and A which have 8. 

Create a transition matrix that only considers notes in the C major scale:
```{r}
P <- matrix(numeric(88), nrow = 88, ncol = 88) #create a zero matrix
P[C_major, C_major] = 1/length(C_major)
rowSums(P)
```

Note that the row sums for the matrix are all 1 for the notes that we are considering, which is what is expected for a Markov transition matrix. 

```{r}
sample <- markov_music(5,P)
generate_lilypond(sample, 5, file_name = here("results", "implement_consonance_ex1.ly"))
```

Note that this process is equivalent to sampling randomly from C major notes, since only C major notes have nonzero probability, with equal probability. This example song can be found in the 'results' directory called 'implement_consonance_ex1.ly'.




